struct X[T]:
    v: T
    fun new: return
    fun [](x: T) -> T: return x

fun f -> int:
    let x = new X
    return x.v

fun g -> int:
    let x = new X[int]
    return x
    return x.v
    let y = new X[str]
    return y
    return y.v
    return x[0]
    return y[0]
    return x[x.v]
    return y[y.v]

fun h -> X[int]:
    return new X[Y]
    return new X[str]

fun i -> int:
    return new X[int].v + 2

struct Z[T]:
    v: T
    fun new(v: T): @v = v

fun j -> char:
    return new Z[char](0).v

#[
ERROR
:23:18: error: undeclared identifier 'Y'
    return new X[Y]
                 ~
:7:17: error: expected non-generic type
    let x = new X
                ~
:1:8: note: 'X' declared here
    struct X[T]:
           ~
:12:12: error: function was declared to return type 'int', not 'X[int]'
    return x
           ~
:10:10: note: function return type declared here
    fun g -> int:
             ~~~
:11:9: note: 'x' declared here
    let x = new X[int]
        ~
:15:12: error: function was declared to return type 'int', not 'X[str]'
    return y
           ~
:10:10: note: function return type declared here
    fun g -> int:
             ~~~
:14:9: note: 'y' declared here
    let y = new X[str]
        ~
:16:14: error: function was declared to return type 'int', not 'str'
    return y.v
             ~
:10:10: note: function return type declared here
    fun g -> int:
             ~~~
:14:9: note: 'y' declared here
    let y = new X[str]
        ~
:2:5: note: 'v' declared here
    v: T
    ~
:18:12: error: no overload of 'X' with given arguments available
    return y[0]
           ~
:4:9: note: function expected argument of type 'T = str', not 'int'
    fun [](x: T) -> T: return x
        ~
:24:17: error: function was declared to return type 'X[int]', not 'X[str]'
    return new X[str]
                ~
:22:11: note: function return type declared here
    fun h -> X[int]:
              ~
]#
